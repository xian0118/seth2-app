<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>戰神賽特2｜統一工具</title>

<style>
body {
    background: #0f0f1a;
    color: white;
    font-family: sans-serif;
    margin: 0;
    padding: 16px;
}
.card {
    background: #1b1b2d;
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 20px;
}
.row {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 12px;
}
.col {
    flex: 1;
    min-width: 150px;
    margin-right: 10px;
}
input {
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    border: none;
    background: #2a2a3d;
    color: white;
}
button {
    background: #7b4dff;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 16px;
    width: 100%;
}
button:active {
    opacity: 0.8;
}
.small {
    font-size: 14px;
    opacity: 0.8;
}
.grid2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    border-bottom: 1px solid #444;
    padding: 6px;
    text-align: center;
}
</style>
</head>

<body>

<h1>戰神賽特2｜統一工具（房型判定 + 評分 + 記錄器）</h1>

<div class="grid2">
    <button onclick="switchTab('classify')">房型自動判定</button>
    <button onclick="switchTab('scoring')">評分 + 自動下注</button>
</div>

<section id="classify" class="card">

<h2>房型自動判定（A/B/C）</h2>
<div class="small">輸入資料後點「判定房型」</div>

<div class="row">
    <div class="col"><label>前二下注額</label><input id="f2_bet"></div>
    <div class="col"><label>前二得分%</label><input id="f2_win"></div>
    <div class="col"><label>前一下注額</label><input id="f1_bet"></div>
    <div class="col"><label>前一得分%</label><input id="f1_win"></div>
</div>

<div class="row">
    <div class="col"><label>未開 下注額</label><input id="unk_bet"></div>
    <div class="col"><label>未開 得分%</label><input id="unk_win"></div>
    <div class="col"><label>當日 下注額</label><input id="today_bet"></div>
    <div class="col"><label>當日 得分%</label><input id="today_win"></div>
</div>

<div class="row">
    <div class="col"><label>近30天 下注額</label><input id="m30_bet"></div>
    <div class="col"><label>近30天 得分%</label><input id="m30_win"></div>
</div>

<div class="row">
    <div class="col"><button id="cf_calc">判定房型</button></div>
    <div class="col"><button id="cf_save">保存判定</button></div>
    <div class="col"><button id="cf_export">匯出 CSV</button></div>
</div>

<div id="cf_out" style="margin-top:8px;"></div>

<div class="card" style="margin-top:12px;">
    <h2>已保存的房型判定</h2>
    <table id="cf_tbl">
        <thead>
            <tr>
                <th>#</th><th>前二(投/率)</th><th>前一(投/率)</th><th>未開(投/率)</th><th>當日(投/率)</th><th>30天(投/率)</th><th>結果</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

</section>

<script>
// 解析輸入
function getInputs() {
    return {
        f2_bet:  Number(document.getElementById("f2_bet").value || 0),
        f2_win:  Number(document.getElementById("f2_win").value || 0),
        f1_bet:  Number(document.getElementById("f1_bet").value || 0),
        f1_win:  Number(document.getElementById("f1_win").value || 0),
        unk_bet: Number(document.getElementById("unk_bet").value || 0),
        unk_win: Number(document.getElementById("unk_win").value || 0),
        today_bet: Number(document.getElementById("today_bet").value || 0),
        today_win: Number(document.getElementById("today_win").value || 0),
        m30_bet: Number(document.getElementById("m30_bet").value || 0),
        m30_win: Number(document.getElementById("m30_win").value || 0)
    };
}

// 房型演算法（簡化版）
function calcType(inp) {
    let scoreA = inp.f2_win + inp.today_win + inp.m30_win;
    let scoreB = inp.f1_win + inp.m30_win;
    let scoreC = inp.unk_win + inp.today_win;

    let arr = [
        {type:"A", score:scoreA},
        {type:"B", score:scoreB},
        {type:"C", score:scoreC}
    ].sort((a,b)=>b.score-a.score);

    return { inp, scores: arr };
}

// 顯示結果
document.getElementById("cf_calc").onclick = () => {
    let res = calcType(getInputs());
    document.getElementById("cf_out").innerHTML =
        `<h3>判定房型：${res.scores[0].type}</h3>`;
};

// 保存
let saved = [];

document.getElementById("cf_save").onclick = () => {
    let res = calcType(getInputs());
    saved.push({
        ...res.inp,
        decided: res.scores[0].type,
        scores: res.scores.map(s => `${s.type}:${s.score}`).join("|")
    });
    renderTable();
};

function renderTable() {
    let tb = document.querySelector("#cf_tbl tbody");
    tb.innerHTML = saved.map((v,i)=>`
        <tr>
            <td>${i+1}</td>
            <td>${v.f2_bet}/${v.f2_win}</td>
            <td>${v.f1_bet}/${v.f1_win}</td>
            <td>${v.unk_bet}/${v.unk_win}</td>
            <td>${v.today_bet}/${v.today_win}</td>
            <td>${v.m30_bet}/${v.m30_win}</td>
            <td>${v.decided}</td>
        </tr>
    `).join("");
}

// 匯出 CSV
document.getElementById("cf_export").onclick = () => {
    let csv = "編號,前二,前一,未開,當日,30天,結果\n";
    saved.forEach((v,i)=>{
        csv += `${i+1},${v.f2_bet}/${v.f2_win},${v.f1_bet}/${v.f1_win},${v.unk_bet}/${v.unk_win},${v.today_bet}/${v.today_win},${v.m30_bet}/${v.m30_win},${v.decided}\n`;
    });

    let blob = new Blob([csv], {type:"text/csv"});
    let url = URL.createObjectURL(blob);
    let a = document.createElement("a");
    a.href = url;
    a.download = "房型判定.csv";
    a.click();
};

</script>

</body>
</html>
